// BEM-style block rules for Obtain Corn Hoop.
//
// Copyright (C) 2013 Damien Dart, <damiendart@pobox.com>.
// This file is distributed under the MIT licence. For more information,
// please refer to the accompanying "LICENCE" file.

@import "functions";
@import "global-variables";
@import "mixins";

/* div */.content {
  $main-content-width: 500px + ($base-layout-unit * 2);
  $side-content-width: 300px;
  $total-content-width: $base-layout-unit +
      $main-content-width + $side-content-width;
  margin: calculate_em($base-layout-unit * 4, $base-font-size) auto
      calculate_em($base-layout-unit, $base-font-size) auto;
  width: calculate_em($total-content-width, $base-font-size);
  @media screen and (max-width:
      calculate_em($total-content-width, $base-font-size)) {
    // Change the top margin to account for the new height of the site header
    // when it collapses vertically.
    margin-top: calculate_em(($base-layout-unit * 4) + 48px, $base-font-size);
    width: 100%; }
  // Remove the top margin to account for the site header becoming static for
  // devices with smaller screens.
  @media screen and ($small-screen-breakpoint) {
    margin-top: 0; }
  @media screen and (max-width: calculate_em(
      $main-content-width + $base-layout-unit, $base-font-size)) {
    margin-bottom: calculate_em($base-layout-unit / 2, $base-font-size); }
  // Don't use a "section" element, because semantics blah blah blah. See
  // <http://html5doctor.com/the-section-element/> for more information.
  /* div */.content__column {
    // Using "inline-block" means there can't any whitespace between columns.
    display: inline-block;
    vertical-align: top;
    /* div, article, nav, etc. */.content__column__block {
      margin: calculate_em($base-layout-unit, $base-font-size) 0 0 0;
      @media screen and (max-width: calculate_em(
          $main-content-width + $base-layout-unit, $base-font-size)) {
        margin-top: calculate_em($base-layout-unit / 2, $base-font-size); } } }
  // Don't use a "section" element, because semantics blah blah blah. See
  // <http://html5doctor.com/the-section-element/> for more information.
  /* div */.content__column--main-column {
    width: calculate_em($main-content-width, $base-font-size);
    @media screen and (max-width: calculate_em(
        $main-content-width + $base-layout-unit, $base-font-size)) {
      // Setting the margin makes the content too wide for small screens;
      // however, changing the "box-sizing" property and setting the padding
      // does the trick, for some reason.
      box-sizing: border-box;
      padding: 0 calculate_em($base-layout-unit / 2, $base-font-size);
      width: 100%; } }
  // Don't use a "section" element, because semantics blah blah blah. See
  // <http://html5doctor.com/the-section-element/> for more information.
  /* div */.content__column--side-column {
    margin: 0 0 0 calculate_em($base-layout-unit, $base-font-size);
    width: calculate_em($side-content-width, $base-font-size); } }

/* ul */.metadata-list {
  list-style: none;
  margin: 0;
  text-align: left;
  padding: 0;
  /* li */.metadata-list__item {
    font-style: italic;
    margin: 0 0 0 calculate_em($base-layout-unit, $base-font-size);
    text-indent: calculate_em($base-layout-unit * -1, $base-font-size);
    &:before {
      // Adjust the font size and line height slighly to make the icon
      // glyphs align better with any adjacent text.
      $font-size: $base-font-size * 0.75;
      $line-height: $base-line-height * 1.2;
      float: left;
      font-family: "Glyphicons Halflings";
      font-size: calculate_percentage($font-size, $base-font-size);
      height: calculate_em($base-line-height, $font-size);
      line-height: calculate_em($line-height, $font-size);
      speak: none; // TODO: Check whether this is necessary.
      width: calculate_em($base-line-height, $font-size); } }
  @each $type in (("date", "\e023"), ("notes", "\e005"),
      ("source", "\e087"), ("tags", "\e042")) {
    /* li */.metadata-list__item--#{nth($type, 1)} {
      &:before {
        content: "#{nth($type, 2)}"; } } } }

/* ul */.navigation-list {
  @include clear-fix;
  list-style: none;
  // Apply negative margins to negate list items' "gutters".
  margin: calculate_em($base-layout-unit / -2, $base-font-size) 0
      0 calculate_em($base-layout-unit / -2, $base-font-size);
  padding-left: 0;
   /* li */.navigation-list__item {
    // Inline-block elements don't like whitespace between each other. See
    // <http://css-tricks.com/fighting-the-space-between-inline-block-elements/>
    // for more information.
    display: inline-block;
    margin: calculate_em($base-layout-unit / 2, $base-font-size) 0
        0 calculate_em($base-layout-unit / 2, $base-font-size);
    /* a */.navigation-list__item__button {
      $background-colour: #ffffff;
      $foreground-colour: #000000;
      @include colour-swap-links($background-colour, $foreground-colour);
      border-radius: calculate_em($base-layout-unit, $base-font-size);
      display: block;
      font-weight: bold;
      padding: calculate_em($base-layout-unit / 2, $base-font-size)
          calculate_em($base-layout-unit, $base-font-size); } }
      text-transform: uppercase;
  /* li */.navigation-list__item--previous {
    float: left; }
  /* li */.navigation-list__item--next {
    float: right; } }

// The markup of blogpost notes is generated by Tumblr and out of our
// control, hence the non-BEM-style class names and hacky CSS.
/* ol */.notes {
  list-style: none;
  margin: 0;
  text-align: left;
  padding: 0;
  /* li */.note {
    margin: 0 0 0 calculate_em($base-layout-unit, $base-font-size);
    blockquote {
      display: inline;
      margin: 0; }
    /* span */.action {
      margin: 0 0 0 calculate_em($base-layout-unit * -1, $base-font-size); }
    /* a */.avatar_frame {
      cursor: default; // Hide the fact that this is a link.
      float: left;
      height: calculate_em($base-line-height, $base-font-size);
      left: calculate_em($base-line-height * -1, $base-font-size);
      // HACK AHOY. Using "pointer-events" to remove mouse events from the
      // HTML element has unintended side-effects. For more information, see
      // <http://css-tricks.com/pointer-events-current-nav/> and
      // <https://developer.mozilla.org/en-US/docs/CSS/pointer-events>.
      pointer-events: none; // Hide the fact that this is a link.
      position: relative;
      width: calculate_em($base-line-height, $base-font-size);
      /* img */.avatar {
        margin: -8px 0 0 0; // Assuming avatar images are 16px by 16px.
        opacity: 0.25; // Poor man's grey tint.
        position: relative;
        top: 50%; } }
    /* div */.clear {
      // This HTML element is unnecessary.
      display: none; } } }

/* section */.post-metadata {
  $background-colour: #ffffff;
  $foreground-colour: lighten(#000000, 75);
  background-color: $background-colour;
  color: $foreground-colour;
  padding: 0 calculate_em($base-layout-unit, $base-font-size)
      calculate_em($base-layout-unit, $base-font-size)
      calculate_em($base-layout-unit, $base-font-size);
  a {
    @include colour-swap-links($background-colour, $foreground-colour); } }

/* section */.post-comments {
  $background-colour: #ffffff;
  $foreground-colour: lighten(#000000, 75);
  background-color: $background-colour;
  @each $prefix in ("", "-moz-", "-webkit-") {
    #{$prefix}box-shadow: inset 0
      calculate_em($base-layout-unit / 2, $base-font-size)
      calculate_em($base-layout-unit / 2, $base-font-size)
      calculate_em($base-layout-unit / -2, $base-font-size)
      darken($background-colour, 30); }
  color: $foreground-colour;
  margin: 0 calculate_em($base-layout-unit, $base-font-size);
  padding: calculate_em($base-layout-unit / 2, $base-font-size)
      calculate_em($base-layout-unit, $base-font-size);
  a {
    @include colour-swap-links($background-colour, $foreground-colour); } }

/* section */.post-body {
  $background-colour: #ffffff;
  $foreground-colour: #000000;
  background-color: $background-colour;
  color: $foreground-colour;
  padding: calculate_em($base-layout-unit, $base-font-size);
  text-align: left;
  a {
    @include colour-swap-links($background-colour, $foreground-colour); }
  blockquote {
    margin: calculate_em($base-line-height / 2, $base-font-size) 0 0 0;
    padding: 0 0 0 calculate_em($base-line-height, $base-font-size); }
  h1 {
    $heading-font-size: 24px;
    $heading-line-height: 36px;
    font-size: calculate_percentage($heading-font-size, $base-font-size);
    line-height: calculate_em($heading-line-height, $heading-font-size);
    margin: 0 0 calculate_em($base-line-height / 2, $heading-font-size) 0; }
  p {
    margin: calculate_em($base-line-height / 2, $base-font-size) 0 0 0;
    &.quote-attribution {
      text-align: right;
      font-style: italic; }
    &:first-child {
      margin: 0; } }
  ol, ul {
    list-style: square;
    margin: calculate_em($base-line-height / 2, $base-font-size) 0
        0 calculate_em($base-line-height, $base-font-size);
    padding: 0;
    & > * {
      margin: 0;
      padding: 0; } } }

/* header */.site-header {
  $background-colour: #000000;
  $foreground-colour: #ffffff;
  $site-header-width: 800px + ($base-layout-unit * 3);
  background-color: $background-colour;
  color: $foreground-colour;
  left: 0;
  position: fixed;
  top: 0;
  width: 100%;
  @media screen and ($small-screen-breakpoint) {
    // We don't have the luxury of screen space on devices with smaller
    // screens, so make the site header static.
    position: static; }
  /* div */.site-header__container {
    @include clear-fix;
    margin: 0 auto;
    padding: $base-layout-unit 0;
    width: calculate_em($site-header-width, $base-font-size);
    @media screen and (max-width:
        calculate_em($site-header-width, $base-font-size)) {
      width: 100%; }
    /* div */.site-header__container__site-title {
      @media screen and (min-width:
          calculate_em($site-header-width, $base-font-size)) {
      float: left; } }
    /* nav */.site-header__container__site-navigation {
      @media screen and (min-width:
          calculate_em($site-header-width, $base-font-size)) {
      float: right; } } } }

/* h1 */.site-title {
  $site-title-font-size: 36px;
  $site-title-line-height: 48px;
  font-size: calculate_percentage($site-title-font-size, $base-font-size);
  line-height: calculate_em($site-title-line-height, $site-title-font-size);
  margin: 0;
  .site-title__link {
    $background-colour: #000000;
    $foreground-colour: #ffffff;
    background-color: $background-colour;
    color: $foreground-colour;
    text-decoration: none;
    &:active, &:focus, &:hover, &:visited, &:visited:hover {
      background-color: $background-colour;
      color: $foreground-colour; } } }

/* ul */.tag-list {
  display: inline;
  padding: 0;
  /* li */.tag-list__item {
    display: inline;
    &:not(:last-child):after {
      content: ", "; } } }

/* h2 */.page-title {
  $page-title-font-size: 30px;
  $page-title-line-height: 36px;
  font-size: calculate_percentage($page-title-font-size, $base-font-size);
  line-height: calculate_em($page-title-line-height, $page-title-font-size);
  margin: 0;
  text-align: center; }
