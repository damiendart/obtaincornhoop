// BEM-style block rules for Obtain Corn Hoop.
//
// Copyright (C) 2013 Damien Dart, <damiendart@pobox.com>.
// This file is distributed under the MIT licence. For more information,
// please refer to the accompanying "LICENCE" file.

@import "functions";
@import "global-variables";
@import "glyphicons-halflings";
@import "mixins";

/* a */.button {
  $background-colour: #ffffff;
  $foreground-colour: #000000;
  @include colour-swap-links($background-colour, $foreground-colour);
  border-radius: calculate_em($base-layout-unit, $base-font-size);
  display: block;
  font-weight: bold;
  padding: calculate_em($base-layout-unit / 2, $base-font-size)
      calculate_em($base-layout-unit, $base-font-size);
  text-transform: uppercase; }

// Don't use a "section" element, because semantics blah blah blah. See
// <http://html5doctor.com/the-section-element/> for more information.
/* div */.content {
  $content-width: 500px + ($base-layout-unit * 2);
  margin: calculate_em($base-layout-unit, $base-font-size) auto;
  width: calculate_em($content-width, $base-font-size);
  @media screen and (max-width:
      calculate_em($content-width, $base-font-size)) {
    margin: calculate_em($base-layout-unit / 2, $base-font-size) auto;
    width: 100%; }
  /* div, article, nav, etc. */.content__block {
    margin: calculate_em($base-layout-unit, $base-font-size) 0 0 0;
    @media screen and (max-width:
        calculate_em($content-width, $base-font-size)) {
      margin: calculate_em($base-layout-unit / 2, $base-font-size) 0 0 0;
      padding: 0 calculate_em($base-layout-unit / 2, $base-font-size); } } }

/* ul */.metadata-list {
  list-style: none;
  margin: 0;
  text-align: left;
  padding: 0;
  /* li */.metadata-list__item {
    font-style: italic;
    margin: 0 0 0 calculate_em($base-layout-unit, $base-font-size);
    text-indent: calculate_em($base-layout-unit * -1, $base-font-size);
    &:before {
      // Adjust font size to make icon glyphs align better with adjacent text.
      $font-size: $base-font-size * 0.75;
      clear: both; // Required for Internet Explorer 9 and onwards.
      float: left;
      font-family: "Glyphicons Halflings";
      font-size: calculate_percentage($font-size, $base-font-size);
      font-style: normal;
      height: calculate_em($base-line-height, $font-size);
      line-height: calculate_em($base-line-height, $font-size);
      speak: none; // TODO: Check whether this is necessary.
      width: calculate_em($base-line-height, $font-size); } }
  @each $type in (("date", "\e023"), ("notes", "\e005"),
      ("source", "\e087"), ("tags", "\e042")) {
    /* li */.metadata-list__item--#{nth($type, 1)} {
      &:before {
        content: "#{nth($type, 2)}"; } } } }

/* ul */.navigation-list {
  @include clear-fix;
  list-style: none;
  // Apply negative margins to negate list items' "gutters".
  margin: calculate_em($base-layout-unit / -2, $base-font-size) 0
      0 calculate_em($base-layout-unit / -2, $base-font-size);
  padding-left: 0;
  /* li */.navigation-list__item {
    // Inline-block elements don't like whitespace between each other. See
    // <http://css-tricks.com/fighting-the-space-between-inline-block-elements/>
    // for more information.
    display: inline-block;
    margin: calculate_em($base-layout-unit / 2, $base-font-size) 0
        0 calculate_em($base-layout-unit / 2, $base-font-size); }
  /* li */.navigation-list__item--previous {
    float: left; }
  /* li */.navigation-list__item--next {
    float: right; } }

// The markup of blogpost notes is generated by Tumblr and out of our
// control, hence the non-BEM-style class names and hacky CSS.
/* ol */.notes {
  list-style: none;
  margin: 0;
  text-align: left;
  padding: 0;
  /* li */.note {
    margin: 0 0 0 calculate_em($base-layout-unit, $base-font-size);
    blockquote {
      display: inline;
      margin: 0; }
    /* span */.action {
      margin: 0 0 0 calculate_em($base-layout-unit * -1, $base-font-size); }
    /* a */.avatar_frame {
      cursor: default; // Hide the fact that this is a link.
      float: left;
      height: calculate_em($base-line-height, $base-font-size);
      left: calculate_em($base-line-height * -1, $base-font-size);
      // HACK AHOY. Using "pointer-events" to remove mouse events from the
      // HTML element has unintended side-effects. For more information, see
      // <http://css-tricks.com/pointer-events-current-nav/> and
      // <https://developer.mozilla.org/en-US/docs/CSS/pointer-events>.
      pointer-events: none; // Hide the fact that this is a link.
      position: relative;
      width: calculate_em($base-line-height, $base-font-size);
      /* img */.avatar {
        border: none;
        display: block;
        margin: -8px 0 0 0; // Assuming avatar images are 16px by 16px.
        opacity: 0.25; // Poor man's grey tint.
        position: relative;
        top: 50%; } }
    /* div */.clear {
      // This HTML element is unnecessary.
      display: none; } } }

/* section */.post-metadata {
  $background-colour: darken(#ffffff, 7.5);
  $foreground-colour: lighten(#000000, 70);
  background-color: $background-colour;
  border-radius: 0 0 calculate_em($base-layout-unit / 4, $base-font-size)
      calculate_em($base-layout-unit / 4, $base-font-size);
  color: $foreground-colour;
  padding: calculate_em($base-layout-unit / 2, $base-font-size)
      calculate_em($base-layout-unit, $base-font-size);
  a {
    @include colour-swap-links($background-colour, $foreground-colour); } }

/* section */.post-comments {
  $background-colour: darken(#ffffff, 7.5);
  $foreground-colour: lighten(#000000, 70);
  background-color: $background-colour;
  border-radius: 0 0 calculate_em($base-layout-unit / 4, $base-font-size)
      calculate_em($base-layout-unit / 4, $base-font-size);
  @each $prefix in ("", "-moz-", "-webkit-") {
    #{$prefix}box-shadow: inset 0
      calculate_em($base-layout-unit / 2, $base-font-size)
      calculate_em($base-layout-unit / 2, $base-font-size)
      calculate_em($base-layout-unit / -2, $base-font-size)
      darken($background-colour, 30); }
  color: $foreground-colour;
  margin: 0 calculate_em($base-layout-unit, $base-font-size);
  padding: calculate_em($base-layout-unit / 2, $base-font-size)
      calculate_em($base-layout-unit, $base-font-size);
  a {
    @include colour-swap-links($background-colour, $foreground-colour); } }

/* section */.post-body {
  $background-colour: #ffffff;
  $foreground-colour: #000000;
  background-color: $background-colour;
  border-radius: calculate_em($base-layout-unit / 4, $base-font-size);
  color: $foreground-colour;
  padding: calculate_em($base-layout-unit, $base-font-size);
  text-align: left;
  &:not(:only-child) {
    border-radius: calculate_em($base-layout-unit / 4, $base-font-size) 
        calculate_em($base-layout-unit / 4, $base-font-size) 0 0; }
  a {
    @include colour-swap-links($background-colour, $foreground-colour); }
  blockquote {
    margin: calculate_em($base-line-height / 2, $base-font-size) 0 0 0;
    padding: 0 0 0 calculate_em($base-line-height, $base-font-size); }
  iframe, img {
    border-style: none; // Remove border on linked images.
    display: block;
    max-width: 100%;
    // FIXME: We shouldn't be applying this to every image and "iframe".
    @media screen and (max-width: calculate_em(500px, $base-font-size)) {
      margin: 0 0 0 calculate_em($base-layout-unit * -1, $base-font-size);
      @each $prefix in ("", "-moz-", "-webkit-") {
        max-width: #{$prefix}calc(100% +
            #{calculate_em($base-layout-unit * 2, $base-font-size)}); } } }
  h1 {
    $heading-font-size: 24px;
    $heading-line-height: 36px;
    font-size: calculate_percentage($heading-font-size, $base-font-size);
    line-height: calculate_em($heading-line-height, $heading-font-size);
    margin: 0 0 calculate_em($base-line-height / 2, $heading-font-size) 0; }
  p {
    margin: calculate_em($base-line-height / 2, $base-font-size) 0 0 0;
    &.quote-attribution {
      text-align: right;
      font-style: italic; }
    &:first-child {
      margin: 0; } }
  ol, ul {
    list-style: square;
    margin: calculate_em($base-line-height / 2, $base-font-size) 0
        0 calculate_em($base-line-height, $base-font-size);
    padding: 0;
    & > * {
      margin: 0;
      padding: 0; } } }

/* header */.site-header {
  $foreground-colour: #ffffff;
  color: $foreground-colour;
  margin: calculate_em($base-layout-unit * 3, $base-font-size) auto;
  /* div */.site-header__container__site-title { }
  /* nav */.site-header__container__site-navigation { } }

/* h1 */.site-title {
  $site-title-font-size: 60px;
  $site-title-line-height: $site-title-font-size;
  font-size: calculate_percentage($site-title-font-size, $base-font-size);
  line-height: calculate_em($site-title-line-height, $site-title-font-size);
  margin: 0;
  @media screen and ($small-screen-breakpoint) {
    $small-screen-font-size: 36px;
    font-size: calculate_percentage($small-screen-font-size, $base-font-size);
    line-height: calculate_em($small-screen-font-size, $small-screen-font-size); }
  .site-title__link {
    $background-colour: transparent;
    $foreground-colour: #ffffff;
    background-color: $background-colour;
    color: $foreground-colour;
    text-decoration: none;
    &:active, &:focus, &:hover, &:visited, &:visited:hover {
      background-color: $background-colour;
      color: $foreground-colour; } } }

/* ul */.tag-list {
  display: inline;
  padding: 0;
  /* li */.tag-list__item {
    display: inline;
    &:not(:last-child):after {
      content: ", "; } } }

/* h2 */.page-title {
  $page-title-font-size: 30px;
  $page-title-line-height: 36px;
  font-size: calculate_percentage($page-title-font-size, $base-font-size);
  line-height: calculate_em($page-title-line-height, $page-title-font-size);
  margin: 0;
  text-align: center; }
